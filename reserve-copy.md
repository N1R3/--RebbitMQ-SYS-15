# Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.

Для оформления вашего решения в GitHub можете воспользоваться шаблоном.

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

### Задание 1. Резервное копирование
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

1.1. Что-бы восстанавливать данные в полном объеме надо учитывать некорорые факторы, такие как нагрузка на базу в течение дня и наличие свободного места на диске.

Если в какое либо время дня нагрузка на базу незначительное и объем базы не большой, то можно расммотреть вариант ежедневного FULL BACKUP, в часы ниаименьшей нагрузки.

Если такого времени нет или обьем базы велик, то оптимальным вариантом будем дифференциальный бэкап.

Для восстановления файлов потребуется последний созданный бэкап и последний дифферницальный.

Скорость создания в разы выше чем у полного бэкапа.

1.2. Для такого варианта восстановления подойдет инкрементый бэкап.

В нем начальная точка - полный бэкап. Затем инкрементый бэкап можно настроить так часто как нам это необходимо.

Настраиваем его выполнение раз в час и получаем возможность восстановления данных за последний час работы.

1.3. Репликация: Master - Slave
Только переключение произойдет не моментально, а когда балансировщик поймет, что мастер недоступен. А это должно быть прописано в настройках, какое время ожидания и ответа.

### Задание 2. PostgreSQL
2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.
2.1 создание дампа
```sql
pg_dump -U user > /tmp/my.dump
```
восстановление
```sql
pg_restore -d mydb my.dumpp
```
2.1* 
```bash
#!/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

PGPASSWORD=password
export PGPASSWORD
pathB=/backup
dbUser=dbuser
database=db

find $pathB \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) -ctime +61 -delete
pg_dump -U $dbUser $database | gzip > $pathB/pgsql_$(date "+%Y-%m-%d").sql.gz

unset PGPASSWORD
```
и добавить скрипт в кронтаб

№№№ Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.

3.1
```sql
 mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
    backup-to-image
```
3.1*
```bash
xtrabackup --backup --target-dir=/data/backups/inc1 --incremental-basedir=/data/backups/base
```
